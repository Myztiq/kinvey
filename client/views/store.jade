extends layout

block content
  #store(data-bind="slideVisible: loginObject().user()")
    div
      .cart
        .button.viewCart(data-bind="click: toggleViewCart, visible: showCart(), text:'View Store'")
        .button.viewCart(data-bind="click: toggleViewCart, visible: !showCart(), text: 'View Cart ('+cartItems()+')', css:{cartUpdated: cartUpdated()}")
      h1 Welcome to the store!
      div(data-bind="template: { foreach: errors }")
        span(data-bind="text: message")
        br
      .cartView(data-bind="slideVisible: showCart()")
        table
          thead
            th Name
            th(width="100px").price Price
            th(width="40px").qty Qty
            th(width="20px")
            th(width="100px")
          tbody
            | <!-- ko foreach: cart -->
            tr
              td
                div(data-bind="text: item.name()")
              td.price
                div(data-bind="text: item.formattedPrice()")
              td.qty
                input(data-bind="value: tmpQty, valueUpdate:'afterkeydown'", type="number", min="0", max="999")
              td.remove
                .button(data-bind="click: $root.removeFromCart") X
              td
                .button(data-bind="click: updateQty, visible: tmpQty() != qty() && tmpQty() > 0") Update
                .button(data-bind="click: $root.removeFromCart, visible: tmpQty() <= 0") Remove
            | <!-- /ko-->
        .subTotal
          | Subtotal:
          span(data-bind="text: cartPrice(), css:{priceUpdated: cartUpdated()}")
        .button.checkout(data-bind="click: checkout") Checkout
        .clear

      .storeView(data-bind="slideVisible: !showCart()")
        .categorySelection
          div(data-bind="foreach: storeCategories")
            .category.button(data-bind="text: $data, click: $parent.selectCategory, css:{active: $data == $parent.selectedCategory()}")
        .noneShown(data-bind="slideVisible: !selectedCategory()") Select a category above
        .storeItems(data-bind="foreach: storeItems")
          .item(data-bind="slideVisible: category() == $parent.selectedCategory()")
            .name(data-bind="text: name")
            .addToCart.button(data-bind="click: $root.addToCart") Add To Cart
            .price(data-bind="text: formattedPrice")


block scripts
  script
    head.ready(function(){
      head.js('/scripts/store.js');
    });