extends layout

block content
  #store(data-bind="slideVisible: loginObject().user()")
    div
      .cart
        .button.viewCart(data-bind="click: viewStore, text:'View Store', css:{active:showStore()}")
        .button.viewCart(data-bind="click: viewCart, visible: cartItems, text: 'View Cart ('+cartItems()+')', css:{cartUpdated: cartUpdated()}, css:{active:showCart()}")
        .button.viewCart(data-bind="click: viewOrderHistory, visible: orderHistory().length, text: 'View Order History', css:{active:showOrderHistory()}")
      h1 Welcome to the store!
      div(data-bind="template: { foreach: errors }")
        span(data-bind="text: message")
        br
      .cartView(data-bind="slideVisible: showCart()")
        h3 Shopping Cart
        table
          thead
            th Name
            th(width="100px").price Price
            th(width="40px").qty Qty
            th(width="20px")
            th(width="100px")
          tbody
            | <!-- ko foreach: cart -->
            tr
              td
                div(data-bind="text: item.name()")
              td.price
                div(data-bind="text: item.formattedPrice()")
              td.qty
                input(data-bind="value: tmpQty, valueUpdate:'afterkeydown'", type="number", min="0", max="999")
              td.remove
                .button(data-bind="click: $root.removeFromCart") X
              td
                .button(data-bind="click: updateQty, visible: tmpQty() != qty() && tmpQty() > 0") Update
                .button(data-bind="click: $root.removeFromCart, visible: tmpQty() <= 0") Remove
            | <!-- /ko-->
        .subTotal
          | Subtotal:
          span(data-bind="text: cartPrice(), css:{priceUpdated: cartUpdated()}")
        .button.checkout(data-bind="click: checkout") Checkout
        .clear
      .orderHistoryView(data-bind="slideVisible: showOrderHistory()")
        h3 Order History
        .orders(data-bind="foreach: orderHistory")
          .orderHeader(data-bind="click: toggleOrderBody")
            span.date(data-bind="text: orderDate")
            span.price(data-bind="text: orderPrice")
            span.items(data-bind="text: orderItems()+' item'+ (orderItems()==1 ? '' : 's')")
            .orderBody(style="display: none")
              table
                thead
                  th(width="900px") Name
                  th(width="100px").price Price
                  th(width="40px").qty Qty
                tbody
                  | <!-- ko foreach: order -->
                  tr
                    td
                      div(data-bind="text: item.name()")
                    td.price
                      div(data-bind="text: item.formattedPrice()")
                    td.qty
                      div(data-bind="text: tmpQty")
                  | <!-- /ko-->
              .subTotal
                | Total:
                span(data-bind="text: orderPrice()")

      .storeView(data-bind="slideVisible: showStore()")
        h3 Store
        .categorySelection
          div(data-bind="foreach: storeCategories")
            .category.button(data-bind="text: $data, click: $parent.selectCategory, css:{active: $data == $parent.selectedCategory()}")
        .noneShown(data-bind="slideVisible: !selectedCategory()") Select a category above
        .storeItems(data-bind="foreach: storeItems")
          .item(data-bind="slideVisible: category() == $parent.selectedCategory()")
            .name(data-bind="text: name")
            .addToCart.button(data-bind="click: $root.addToCart") Add To Cart
            .price(data-bind="text: formattedPrice")


block scripts
  script
    head.ready(function(){
      head.js('/scripts/store.js');
    });